//--------------------------------------------------------------------------------------
// Copyright (c) XU, Tianchen. All rights reserved.
//--------------------------------------------------------------------------------------

#include "DecodeVisibility.hlsli"

//--------------------------------------------------------------------------------------
// Structure
//--------------------------------------------------------------------------------------
struct PSIn
{
	float4 Pos : SV_POSITION;
	float2 UV : TEXCOORD;
};

//--------------------------------------------------------------------------------------
// Constant buffer
//--------------------------------------------------------------------------------------
cbuffer cbPerObject
{
	uint g_meshId;
};

//--------------------------------------------------------------------------------------
// Textures
//--------------------------------------------------------------------------------------
Texture2D g_txBaseColors[];

//--------------------------------------------------------------------------------------
// Texture sampler
//--------------------------------------------------------------------------------------
SamplerState g_sampler;

//--------------------------------------------------------------------------------------
// Base visiblity-buffer pass with alpha test
//--------------------------------------------------------------------------------------
uint main(PSIn input, uint primitiveId : SV_PrimitiveID) : SV_TARGET
{
	const float4 baseColor = g_txBaseColors[g_meshId].Sample(g_sampler, input.UV);
	clip(baseColor.w - 0.5);

	return ((g_meshId << PRIMITIVE_BITS) | primitiveId) + 1;
}
